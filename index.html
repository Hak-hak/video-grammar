<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Mô phỏng: Học Ngữ pháp Thời Đại Mới (Có Âm thanh)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #f0f4f8;
        }
        .video-player {
            width: 100%;
            max-width: 900px;
            aspect-ratio: 16 / 9;
            background: #000;
            position: relative;
            overflow: hidden;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .scene {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.7s ease-in-out;
            visibility: hidden;
            background-size: cover;
            background-position: center;
            padding: 2rem;
        }
        .scene.active {
            opacity: 1;
            visibility: visible;
        }
        .narration {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px 30px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            text-align: center;
            font-size: 1.25rem;
            transition: opacity 0.5s;
        }
        .controls {
            background: #1f2937;
            padding: 1rem;
            border-bottom-left-radius: 1rem;
            border-bottom-right-radius: 1rem;
        }
        #progressBar {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #4b5563;
            outline: none;
            border-radius: 4px;
            transition: opacity 0.2s;
        }
        #progressBar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        .icon-container {
            font-size: 5rem;
            color: #3b82f6;
            margin-bottom: 1rem;
            text-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .icon-container-small {
             font-size: 3rem;
             color: #ffffff;
        }

        /* Animations */
        @keyframes fly-around {
            0% { transform: translate(0, 0) rotate(0deg); opacity: 1; }
            25% { transform: translate(40px, -60px) rotate(90deg); opacity: 0.8; }
            50% { transform: translate(-50px, 30px) rotate(180deg); opacity: 1; }
            75% { transform: translate(30px, 50px) rotate(270deg); opacity: 0.7; }
            100% { transform: translate(0, 0) rotate(360deg); opacity: 1; }
        }
        .flying-rule {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #1f2937;
            animation: fly-around 10s linear infinite;
        }
        .balance-animation {
            animation: balance 3s ease-in-out forwards;
        }
        @keyframes balance {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
        }
        .lego-build {
            animation: build 2s ease-out forwards;
        }
        @keyframes build {
            from { opacity: 0; transform: translateY(50px) scale(0.5); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 text-center mb-4">Video Mô phỏng: Học Ngữ pháp Thời Đại Mới</h1>
        <p class="text-center text-gray-600 mb-6">Nhấn nút Play để bắt đầu. Nhấn vào biểu tượng loa để bật/tắt âm thanh lời dẫn.</p>
    </div>

    <div class="video-player-container w-full max-w-4xl">
        <div class="video-player">
            <!-- Scene 1 -->
            <div id="scene-1" class="scene active" style="background-color: #dbeafe;">
                <div class="icon-container">
                    <i class="fas fa-book"></i>
                </div>
                <h2 class="text-4xl font-bold text-gray-800 text-center px-4">Nỗi Đau Mang Tên "Ngữ Pháp"</h2>
                <div class="flying-rule" style="top: 20%; left: 15%; animation-delay: 0s;">Past Perfect</div>
                <div class="flying-rule" style="top: 60%; left: 75%; animation-delay: -2s;">Subjunctive</div>
                <div class="flying-rule" style="top: 70%; left: 25%; animation-delay: -5s;">Gerunds</div>
                <div class="flying-rule" style="top: 30%; left: 80%; animation-delay: -8s;">Conditionals</div>
            </div>

            <!-- Scene 2 -->
            <div id="scene-2" class="scene" style="background-color: #e0f2fe;">
                 <div class="flex space-x-12 items-center">
                    <div class="text-center">
                        <div class="icon-container-small"><i class="fas fa-robot"></i></div>
                        <p class="text-white font-bold">Độ chính xác</p>
                    </div>
                    <div class="text-white text-6xl balance-animation">+</div>
                    <div class="text-center">
                        <div class="icon-container-small"><i class="fas fa-water"></i></div>
                        <p class="text-white font-bold">Sự trôi chảy</p>
                    </div>
                </div>
                <h2 class="text-4xl font-bold text-white text-center mt-8 px-4">Cuộc Cách Mạng Tư Duy</h2>
            </div>
            
            <!-- Scene 3 -->
            <div id="scene-3" class="scene" style="background-color: #dcfce7;">
                <div class="icon-container">
                    <i class="fas fa-users"></i>
                </div>
                <h2 class="text-4xl font-bold text-gray-800 text-center px-4">Hệ Sinh Thái Cho Nhà Giáo Dục</h2>
                <div id="scene-3-subtitle" class="text-2xl text-gray-700 mt-4"></div>
            </div>

            <!-- Scene 4 -->
            <div id="scene-4" class="scene" style="background-color: #fefce8;">
                 <div class="icon-container">
                    <i class="fas fa-rocket"></i>
                </div>
                <h2 class="text-4xl font-bold text-gray-800 text-center px-4">Lộ Trình Tăng Tốc Cho Người Tự Học</h2>
                <div id="scene-4-subtitle" class="text-2xl text-gray-700 mt-4"></div>
            </div>

            <!-- Scene 5 -->
            <div id="scene-5" class="scene" style="background-color: #f3e8ff;">
                <div class="icon-container lego-build">
                    <i class="fas fa-cubes"></i>
                </div>
                <h2 class="text-4xl font-bold text-gray-800 text-center px-4">Bạn là Kiến Trúc Sư</h2>
            </div>

            <div class="narration">
                <p id="narration-text">Nhấn Play để bắt đầu.</p>
            </div>
        </div>
        <div class="controls flex items-center gap-4">
            <button id="playPauseBtn" class="text-white text-2xl w-12 h-12 flex items-center justify-center rounded-full bg-blue-600 hover:bg-blue-700 transition">
                <i class="fas fa-play"></i>
            </button>
            <button id="muteBtn" class="text-white text-2xl w-12 h-12 flex items-center justify-center rounded-full bg-gray-600 hover:bg-gray-700 transition">
                <i class="fas fa-volume-xmark"></i>
            </button>
            <div class="text-white" id="timer">0:00 / 3:50</div>
            <input type="range" id="progressBar" value="0" min="0" max="230">
        </div>
    </div>

    <script>
        const scenes = document.querySelectorAll('.scene');
        const narrationText = document.getElementById('narration-text');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const muteBtn = document.getElementById('muteBtn');
        const progressBar = document.getElementById('progressBar');
        const timerDisplay = document.getElementById('timer');

        // Total duration in seconds based on script (3:50)
        const totalDuration = 230; 
        progressBar.max = totalDuration;

        let currentTime = 0;
        let isPlaying = false;
        let isMuted = true; // Audio is off by default
        let interval;
        let lastSpokenText = "";

        // Function to speak text using Web Speech API
        function speak(text) {
            if (isMuted || !('speechSynthesis' in window)) {
                return;
            }
            // Don't re-speak the same text in the same segment
            if (text === lastSpokenText) {
                return;
            }
            
            speechSynthesis.cancel(); // Stop any previous speech
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'vi-VN'; // Set language to Vietnamese
            utterance.rate = 0.9;
            speechSynthesis.speak(utterance);
            lastSpokenText = text;
        }
        
        // Convert script times like "1:15" to seconds
        const scriptToSeconds = (timeStr) => {
            const [min, sec] = timeStr.split(':').map(Number);
            return min * 60 + sec;
        };

        const timelineInSeconds = [
            { start: 0, end: 10, scene: 1, text: "Ngữ pháp... Chỉ cần nghe tên thôi là nhiều người trong chúng ta đã thấy đau đầu, phải không?" },
            { start: 10, end: 25, scene: 1, text: "Nếu có, thì video này chính là dành cho bạn. Đã đến lúc chúng ta nói lời tạm biệt với những cách học cũ kỹ..." },
            { start: 25, end: 40, scene: 2, text: "Cuộc cách mạng lớn nhất là sự thay đổi trong tư duy: từ việc coi ngữ pháp là bộ quy tắc... sang xem nó là công cụ giao tiếp." },
            { start: 40, end: 55, scene: 2, text: "Mục tiêu không phải là tạo ra những câu hoàn hảo, mà là truyền đạt ý nghĩa. Phương pháp hiện đại giúp bạn đạt được cả hai!" },
            { start: 55, end: 57, scene: 3, text: "Vậy, một lớp học ngữ pháp hiện đại trông như thế nào? Đó là một hệ sinh thái năng động!" },
            { start: 57, end: scriptToSeconds("1:15"), scene: 3, text: "Với Lớp học đảo ngược, thời gian trên lớp không còn dùng để nghe giảng, mà để thực hành và tương tác.", sub: "Lớp học đảo ngược" },
            { start: scriptToSeconds("1:15"), end: scriptToSeconds("1:35"), scene: 3, text: "Tiếp theo, học sinh được học qua Nhiệm vụ thực tế. Ngữ pháp tự nhiên nảy sinh khi các em thực sự cần đến nó.", sub: "Học qua nhiệm vụ (TBLT)" },
            { start: scriptToSeconds("1:35"), end: scriptToSeconds("1:50"), scene: 3, text: "Và cuối cùng, việc ôn tập không còn nhàm chán với Trò chơi hóa!", sub: "Trò chơi hóa (Gamification)" },
            { start: scriptToSeconds("1:50"), end: scriptToSeconds("1:52"), scene: 4, text: "Còn nếu bạn tự học thì sao? Công nghệ chính là người bạn đồng hành tốt nhất của bạn!" },
            { start: scriptToSeconds("1:52"), end: scriptToSeconds("2:10"), scene: 4, text: "Hãy bắt đầu với Khai thác câu. Hãy 'khai thác' những câu hoàn chỉnh từ phim, sách bạn yêu thích.", sub: "Khai thác câu (Sentence Mining)" },
            { start: scriptToSeconds("2:10"), end: scriptToSeconds("2:35"), scene: 4, text: "Sau đó, đưa chúng vào một Hệ thống Lặp lại Ngắt quãng như Anki để ghi nhớ kiến thức sâu và lâu dài.", sub: "Hệ thống Lặp lại Ngắt quãng (SRS)" },
            { start: scriptToSeconds("2:35"), end: scriptToSeconds("3:00"), scene: 4, text: "Cuối cùng, hãy kích hoạt kiến thức! Thực hành nói 24/7 với Gia sư AI và biến chính những lỗi sai của mình thành tài liệu học.", sub: "Gia sư AI & Phản hồi" },
            { start: scriptToSeconds("3:00"), end: scriptToSeconds("3:20"), scene: 5, text: "Không có một phương pháp thần kỳ duy nhất. Cách học hiệu quả nhất chính là một hệ sinh thái tích hợp." },
            { start: scriptToSeconds("3:20"), end: scriptToSeconds("3:40"), scene: 5, text: "Dù bạn là giáo viên hay người tự học, bạn chính là kiến trúc sư cho hành trình học tập của mình." },
            { start: scriptToSeconds("3:40"), end: totalDuration, scene: 5, text: "Bạn đang áp dụng phương pháp nào? Hãy chia sẻ ở phần bình luận nhé!" },
        ];


        function updateVideo() {
            const currentSegment = timelineInSeconds.find(s => currentTime >= s.start && currentTime < s.end);

            if (currentSegment) {
                // Update scene
                scenes.forEach((scene, index) => {
                    if (index + 1 === currentSegment.scene) {
                        if (!scene.classList.contains('active')) {
                           lastSpokenText = ""; // Reset spoken text when scene changes
                           scene.classList.add('active');
                        }
                    } else {
                        scene.classList.remove('active');
                    }
                });

                // Update narration text on screen
                narrationText.textContent = currentSegment.text;
                
                // Speak the narration if playing
                if (isPlaying) {
                    speak(currentSegment.text);
                }
                
                // Update subtitles for scenes 3 & 4
                const scene3Sub = document.getElementById('scene-3-subtitle');
                const scene4Sub = document.getElementById('scene-4-subtitle');
                scene3Sub.textContent = (currentSegment.scene === 3 && currentSegment.sub) ? currentSegment.sub : '';
                scene4Sub.textContent = (currentSegment.scene === 4 && currentSegment.sub) ? currentSegment.sub : '';
            }

            // Update progress bar and timer
            progressBar.value = currentTime;
            const minutes = Math.floor(currentTime / 60);
            const seconds = Math.floor(currentTime % 60);
            const totalMinutes = Math.floor(totalDuration / 60);
            const totalSeconds = Math.floor(totalDuration % 60);
            timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')} / ${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
        }

        function play() {
            isPlaying = true;
            playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            updateVideo(); // Speak the current line immediately on play
            interval = setInterval(() => {
                currentTime++;
                if (currentTime > totalDuration) {
                    pause();
                    currentTime = 0;
                    updateVideo(); // Update UI to show 0:00
                } else {
                    updateVideo();
                }
            }, 1000);
        }

        function pause() {
            isPlaying = false;
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            clearInterval(interval);
            speechSynthesis.cancel(); // Stop audio on pause
        }

        playPauseBtn.addEventListener('click', () => {
            if (isPlaying) {
                pause();
            } else {
                play();
            }
        });
        
        muteBtn.addEventListener('click', () => {
            isMuted = !isMuted;
            if (isMuted) {
                muteBtn.innerHTML = '<i class="fas fa-volume-xmark"></i>';
                speechSynthesis.cancel(); // Stop audio when muted
            } else {
                muteBtn.innerHTML = '<i class="fas fa-volume-high"></i>';
                // If playing, speak the current text immediately
                if (isPlaying) {
                    lastSpokenText = ""; // Force re-speak
                    updateVideo();
                }
            }
        });

        progressBar.addEventListener('input', (e) => {
            speechSynthesis.cancel(); // Stop audio on seek
            lastSpokenText = ""; // Allow re-speaking after seek
            currentTime = parseInt(e.target.value);
            updateVideo();
            if (isPlaying) {
                clearInterval(interval); // Reset interval to sync with new time
                play();
            }
        });

        // Initial setup
        updateVideo();
    </script>

</body>
</html>
